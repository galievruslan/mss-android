package com.mss.android.web.repositories;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.HttpURLConnection;
import java.net.MalformedURLException;
import java.net.URL;

import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.params.BasicHttpParams;
import org.apache.http.params.HttpParams;

public class WebServer {
	
	String address;
	
	public WebServer(String address) {		
		this.address = address;
	}
	
	String login;
	String password;
	
	public WebConnection connect(String login, String password) throws WebConnectionException{		
		this.login = login;
		this.password = password;
		
		webConnection = new WebConnection(this);			
		try {
			HttpClient httpClient = new DefaultHttpClient();
			HttpParams params = new BasicHttpParams();
			params.setParameter("http.protocol.handle-redirects",false);
						
			HttpGet httpGet = new HttpGet(address + "/users/sign_in");
			httpGet.addHeader("User-Agent", "MSS.Android mobile client");
			httpGet.setParams(params);
			
			String cookie = webConnection.getCookie();
			if (cookie.length() > 0) {
				httpGet.setHeader("Cookie", cookie);	
			}	
			
			HttpResponse response = httpClient.execute(httpGet);
			
			String output = "";
			BufferedReader br = new BufferedReader(new InputStreamReader(
				(response.getEntity().getContent())));
		 		
			while ((output = br.readLine()) != null) {
				System.out.println(output);
			}
			
		} catch (IOException e) { 
			e.printStackTrace(); 
		}
		
		return webConnection;
	}
	
	private WebConnection webConnection;
	public WebConnection getCurrent(){
		return webConnection;
	}
}
